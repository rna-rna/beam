Since you want to always respect the image's natural ratio, Option A (removing AspectRatio) is definitely the right choice. Here are the specific steps for implementation:

Remove AspectRatio everywhere:

typescriptCopy// REMOVE these lines from your imports
import { AspectRatio } from "@/components/ui/aspect-ratio";

Replace the image rendering code in your renderImage function:

typescriptCopyconst renderImage = (image: ImageOrPending, index: number) => (
  <div 
    key={image.id}
    className="mb-4 w-full"
    style={{ breakInside: "avoid" }}
  >
    <motion.div
      layout="position"
      className="image-container relative"
    >
      <div className="relative">
        <img
          src={'localUrl' in image ? image.localUrl : image.url}
          alt={image.originalFilename || "Uploaded image"}
          className={cn(
            "w-full h-auto object-contain rounded-lg transition-opacity duration-200",
            'localUrl' in image && "opacity-80",
            image.status === "error" && "opacity-50"
          )}
          loading="lazy"
        />
        
        {/* Upload indicators */}
        {'localUrl' in image && (
          <div className="absolute inset-0 flex items-center justify-center">
            {image.status === "uploading" && (
              <>
                <div className="absolute top-2 right-2 bg-background/80 backdrop-blur-sm p-2 rounded-full">
                  <Loader2 className="h-4 w-4 animate-spin" />
                </div>
                <Progress value={image.progress} className="w-3/4 h-1" />
              </>
            )}
          </div>
        )}
      </div>
    </motion.div>
  </div>
);

Update your CSS (in index.css) to ensure proper Masonry behavior:

cssCopy.masonrygrid {
  display: flex;
  width: 100%;
}

.image-container {
  width: 100%;
  break-inside: avoid;
}

/* Remove any CSS that might be forcing heights */
.image-container img {
  width: 100%;
  height: auto;
  display: block; /* Prevents bottom margin issues */
}

For the lightbox, update that code too:

typescriptCopy{/* Inside your lightbox */}
<div className="relative w-full">
  <img
    src={getR2ImageUrl(selectedImage)}
    alt={selectedImage.originalFilename || ""}
    className="w-full h-auto object-contain"
  />
</div>