Current Flow (Observed from Code in Gallery.tsx):
When MessageCircle (comment icon) is clicked, isCommentPlacementMode is set to true, allowing bubble placement.
The modal only appears after the bubble is placed if the user is unauthenticated.
Desired Flow:
Click comment icon.
If unauthenticated, trigger login modal immediately.
If authenticated, proceed to place the bubble.
Fix â€“ Trigger Modal When Entering Comment Mode:
Modify the Comment Icon Click Handler (Gallery.tsx):
tsx
Copy code
<Button
  variant="secondary"
  size="icon"
  className={`h-12 w-12 bg-background/95 hover:bg-background shadow-lg text-white ${
    isCommentPlacementMode ? "bg-primary/20" : ""
  }`}
  onClick={(e) => {
    e.stopPropagation();
    if (!user) {
      // Show login modal if user is not authenticated
      setIsCommentModalOpen(true);
      console.log('User not authenticated, showing modal'); // Debug log
      return;
    }
    setIsCommentPlacementMode(!isCommentPlacementMode);
    setIsAnnotationMode(false);
    setNewCommentPos(null);
  }}
  title="Add Comment"
>
  <MessageCircle
    className={`h-8 w-8 transition-all duration-300 hover:scale-110 ${
      isCommentPlacementMode ? "text-primary" : ""
    }`}
  />
</Button>
Why This Fix Works:
Immediate Modal Trigger:
The login modal appears right after clicking the comment icon, ensuring the user authenticates before entering placement mode.
No Interruption After Login:
Upon successful login, the user can immediately proceed to place the comment bubble without re-clicking the icon.
Ensure Modal Renders (Gallery.tsx):
tsx
Copy code
const renderCommentDialog = () => {
  if (!isCommentModalOpen) return null;

  return (
    <CommentModal
      isOpen={isCommentModalOpen}
      onClose={() => {
        setIsCommentModalOpen(false);
        console.log('Comment modal closed'); // Debug log
      }}
      onSubmit={() => {
        console.log('User logged in, ready to place comment'); // Debug log
        setIsCommentPlacementMode(true);
      }}
    />
  );
};
Flow After Fix:
Click the comment icon.
If logged out:
The modal appears immediately.
After login, the user can start placing bubbles.
If logged in:
Comment bubble placement begins immediately.
